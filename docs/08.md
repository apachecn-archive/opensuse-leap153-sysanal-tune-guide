# 8 通用系统资源管理

> 原文：<https://doc.opensuse.org/documentation/leap/tuning/html/book-tuning/cha-tuning-resources.html>

###### 摘要

调优系统不仅仅是优化内核或充分利用应用程序，它从建立一个精简快速的系统开始。您设置分区和文件系统的方式会影响服务器的速度。活动服务的数量和例行任务的调度方式也会影响性能。

[8.1 计划安装](cha-tuning-resources.html#cha-tuning-resources-installation)

[8.2 禁用不必要的服务](cha-tuning-resources.html#cha-tuning-resources-services)

[8.3 File systems and disk access](cha-tuning-resources.html#cha-tuning-resources-disk)

## 8.1 计划安装

精心规划的安装可确保系统完全按照您的需求进行设置。在微调系统时，它还可以节省大量时间。本节建议的所有更改可在安装过程中的安装设置步骤中进行。详见书“_启动_”，第 3 章“安装步骤”，第 3.11 节“安装设置”。

### 8.1.1 分区

根据服务器的应用程序范围和硬件布局，分区方案会影响机器的性能(尽管影响程度较小)。为特定工作负载建议不同的分区方案超出了本手册的范围。但是，以下规则将对性能产生积极影响。它们不适用于使用外部存储系统的情况。

- 请确保磁盘上始终有一些可用空间，因为满磁盘会带来较差的性能

- 将同时读写访问分散到不同的磁盘上，例如:

  - 为操作系统、数据和日志文件使用单独的磁盘

  - 将邮件服务器的假脱机目录放在单独的磁盘上

  - 在不同的磁盘之间分配家庭服务器的用户目录

### 8.1.2 安装范围

安装范围对机器的性能没有直接影响，但是仔细选择包装范围是有好处的。建议安装运行服务器所需的最少数量的软件包。具有最小软件包集的系统更容易维护，潜在的安全问题也更少。此外，定制的安装范围还可以确保默认情况下不会启动不必要的服务。

openSUSE Leap 让您在安装摘要屏幕上自定义安装范围。默认情况下，您可以为特定的任务选择或删除预配置的模式，但是也可以启动 YaST 软件管理器进行细粒度的基于包的选择。

并非在所有情况下都需要以下一种或多种默认模式:

GNOME desktop environment

服务器很少需要完整的桌面环境。如果需要图形环境，一个更经济的解决方案，如 IceWM 就足够了。

X Window System

当通过命令行单独管理服务器及其应用程序时，请考虑不要安装此模式。但是，请记住，需要从远程机器上运行 GUI 应用程序。如果您的应用程序由 GUI 管理，或者如果您更喜欢 YaST 的 GUI 版本，请保持这种模式。

Print server

只有当您想从机器上打印时，才需要此图案。

### 8.1.3 默认目标

一个正在运行的 X Window 系统会消耗很多资源，在服务器上很少需要。强烈建议在目标`multi-user.target`启动系统。您仍然可以远程启动图形应用程序。

## 8.2 禁用不必要的服务

默认安装会启动几个服务(数量因安装范围而异)。由于每个服务都会消耗资源，因此建议禁用不需要的服务。运行 YaST 系统服务管理器启动服务管理模块。

如果您使用的是图形版本的 YaST，您可以单击列标题来对服务列表进行排序。使用它来获得当前正在运行的服务的概述。使用开始/停止按钮禁用正在运行的会话的服务。要永久禁用它，使用启用/禁用按钮。

下面列出了安装 openSUSE Leap 后默认启动的服务。检查您需要哪些组件，并禁用其他组件:

alsasound

加载高级 Linux 声音系统。

auditd

审计系统的守护程序(详见 书 "_安全和加固指南_")。如果不使用审计，请禁用此选项。

bluez-coldplug

处理蓝牙适配器的冷插。

cups

打印机守护程序。

java.binfmt_misc

启用`*.class`或`*.jar` Java 程序的执行。

nfs

登上 NFS 山所需的服务。

smbfs

从 Windows\*服务器装载中小企业/CIFS 文件系统所需的服务。

splash / splash_early

显示启动时的启动画面。

## 8.3 文件系统和磁盘访问

硬盘是计算机系统中最慢的组件，因此经常是瓶颈的原因。使用最适合您的工作负载的文件系统有助于提高性能。使用特殊的挂载选项或区分进程的 I/O 优先级是进一步提高系统速度的方法。

### 8.3.1 文件系统

openSUSE Leap 附带了几个文件系统，包括 Btrfs、Ext4、Ext3、Ext2 和 XFS。每个文件系统都有自己的优点和缺点。

#### 8.3.1. NFS

在 http://nfs.sourceforge.net/nfs-howto/的 NFS Howto 中详细介绍了 NFS(版本 3)调优。当装载 NFS 共享时，首先要试验的是通过使用装载选项`wsize`和`rsize`将读写块大小增加到`32768`。

### 8.3.2 时间戳更新策略

文件系统中的每个文件和目录都有三个与之相关的时间戳:最后一次读取文件的时间称为 _访问时间_ ，最后一次修改文件数据的时间称为 _修改时间_ ，最后一次修改文件元数据的时间称为 _更改时间_ 。保持访问时间始终是最新的会产生很大的性能开销，因为每次只读访问都会导致写操作。因此，默认情况下，只有当当前文件访问时间超过一天或者超过文件修改或更改时间时，每个文件系统才会更新访问时间。该特性称为 _相对访问时间_ ，对应的挂载选项为`relatime`。使用`noatime`挂载选项可以完全禁用访问时间的更新，但是您需要验证您的应用程序没有使用它。对于文件和 Web 服务器或网络存储来说都是如此。如果默认的相对访问时间更新策略不适合您的应用程序，请使用`strictatime`挂载选项。

一些文件系统(例如 Ext4)也支持惰性时间戳更新。当使用`lazytime`挂载选项启用此功能时，所有时间戳的更新都发生在内存中，但不会写入磁盘。只有在响应`fsync`或`sync`系统调用时，当由于文件大小更新等其他原因写入文件信息时，当时间戳超过 24 小时时，或者当缓存的文件信息需要从内存中清除时，才会发生这种情况。

要更新用于文件系统的挂载选项，可以直接编辑`/etc/fstab`，或者在用 YaST 分区器编辑或添加分区时使用 Fstab 选项对话框。

### 8.3.3

`ionice`命令允许您为单个进程区分磁盘访问的优先级。这使您能够为具有大量磁盘访问且对时间要求不严格的后台进程(如备份作业)提供较低的 I/O 优先级。`ionice`还允许您提高特定进程的 I/O 优先级，以确保该进程始终可以立即访问磁盘。此功能的注意事项是，标准写入缓存在页面缓存中，只有在稍后由独立的内核进程写回持久存储。因此，I/O 优先级设置通常不适用于这些写入。还要注意 I/O 类别和优先级设置仅由 blk-mq I/O 路径的 I/O 调度程序遵守(参见[第 12.2 节，“具有 blk-mq I/O 路径的可用 I/O 电梯”](cha-tuning-io.html#cha-tuning-io-schedulers-blkmq))。您可以设置以下三种调度类别:

_Idle_

_只有当没有其他进程请求磁盘 I/O 时，空闲调度类中的进程才被授予磁盘访问权。_

_Best effort_

_用于任何没有请求特定 I/O 优先级的进程的默认调度类。该级别内的优先级可以调整为从`0`到`7`的级别(其中`0`为最高优先级)。以相同的尽力而为优先级运行的程序以循环方式提供服务。一些内核版本以不同的方式对待尽力而为类中的优先级——有关详细信息，请参考`ionice(1)`手册页。_

_Real-time_

_该类中的进程总是首先被授予磁盘访问权限。将优先级从`0`微调到`7`(其中`0`为最高优先级)。请小心使用，因为它会使其他进程处于饥饿状态。_

*有关更多详细信息和确切的命令语法，请参考`ionice(1)`手册页。如果您需要对每个应用程序可用的带宽进行更可靠的控制，请使用第 9 章[*内核控制组*](cha-tuning-cgroups.html)中描述的内核控制组。*
